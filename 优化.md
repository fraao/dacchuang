# 代码优化

## 数据库插入方面：

优化前：

```python
def database_connect(do_what: str, sql: str, *args) -> tuple:
    is_success = True
    conn = pymysql.connect(host='localhost',
                           user='root',
                           password='123456',
                           database='USIP')
    cursor = conn.cursor()
    data = 'ok'
    try:
        if do_what == 'in' or do_what == 'upd' or do_what == 'del':
            cursor.execute(sql, args)
            conn.commit()
        elif do_what == 'out':  # 向数据库读出图片做网页端呈现用
            cursor.execute(sql, args)
            data = cursor.fetchall()
    except Exception as e:
        is_success = False  # 有异常,返回False
        traceback.print_exc()  # 追踪错误信息
        data = 'false'
    finally:
        cursor.close()
        conn.close()
    return is_success, data
```

优化后：

```python
def database_connect(sql, args=None, do_what='out'):
    config = {
        'host': 'localhost',
        'user': 'root',
        'password': '123456',
        'database': 'USIP',
        'cursorclass': pymysql.cursors.DictCursor
    }
    is_success = True
    data = 'ok'
    try:
        with pymysql.connect(**config) as conn:
            with conn.cursor() as cursor:
                if do_what == 'in' or do_what == 'upd' or do_what == 'del':
                    cursor.execute(sql, args)
                    conn.commit()
                elif do_what == 'out':
                    cursor.execute(sql, args)
                    data = cursor.fetchall()
    except Exception as e:
        is_success = False
        traceback.print_exc()
        data = 'false'

    return is_success, data
```



1.将数据库连接信息放到配置文件中，避免了把数据库连接信息写死在代码里。

2.使用with语句管理数据库连接，简化代码。

3.使用异常处理来判断是否连接成功。

4.使用函数参数默认值来支持多种不同的操作。



- 将标头信息提取到单独的常量中，这样就不需要多次重复。
- 使用字符串格式而不是串联在标头中创建用户代理字符串。
- 重构异常处理，使其在一个位置完成，而不是在调用 requests.get 的每个位置重复。这可以通过在发生异常时返回 None 的自定义函数中包装对 requests.get 的调用来完成。
- 简化一天、时间、人员和金钱信息的解析。例如，可以使用正则表达式从字符串中提取所需的信息。
- 通过对搜索属性的 xpath 表达式使用正确的语法来重构使用 xpath 的方式。正确的语法是 。`//a[@class='journal-item cf']`
- 重构提取 、、 和 的代码。更简洁的方法是使用单个正则表达式和组捕获一次性提取所有信息。`n``m``ren1111``c`

1









